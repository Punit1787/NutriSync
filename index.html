<!DOCTYPE html>
<html lang="en">
<head>
<script>
  // Auto-detect API base: use Render URL when hosted, localhost when developing
  window.API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
    ? 'http://localhost:8000'
    : 'https://nutrisync-vgjj.onrender.com';
</script>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>NutriSync â€“ Sync Your Meals. Energize Your Life.</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<style>
  :root{--green:#2d6a4f;--gl:#52b788;--gp:#d8f3dc;--cream:#fefdf8;--dark:#1a2e1e;--gray:#6b7a6d;}
  *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
  html{scroll-behavior:smooth;}
  body{font-family:'DM Sans',sans-serif;background:var(--cream);color:var(--dark);overflow-x:hidden;}

  #splash{position:fixed;inset:0;background:var(--dark);z-index:9999;display:flex;align-items:center;justify-content:center;flex-direction:column;animation:splashOut 0.5s ease 2s forwards;}
  .sl{font-family:'Playfair Display',serif;font-size:3rem;font-weight:900;color:var(--gl);animation:up .7s ease .2s both;}
  .st{font-size:.95rem;color:#8fb896;margin-top:.5rem;animation:up .7s ease .6s both;}
  .sb{width:160px;height:3px;background:#2d4a32;border-radius:2px;margin-top:1.5rem;overflow:hidden;animation:up .7s ease .8s both;}
  .sf{height:100%;background:var(--gl);animation:grow 1.1s ease .9s forwards;width:0;}
  @keyframes splashOut{to{opacity:0;pointer-events:none;}}
  @keyframes up{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:none;}}
  @keyframes grow{to{width:100%;}}

  nav{position:fixed;top:0;width:100%;z-index:100;padding:1rem 5%;display:flex;align-items:center;justify-content:space-between;background:rgba(254,253,248,.93);backdrop-filter:blur(10px);border-bottom:1px solid rgba(45,106,79,.1);animation:fadeD .7s ease 2.3s both;}
  @keyframes fadeD{from{opacity:0;transform:translateY(-16px);}to{opacity:1;transform:none;}}
  .nav-logo{font-family:'Playfair Display',serif;font-size:1.4rem;font-weight:900;color:var(--green);}
  .nav-logo span{color:var(--gl);}
  .navl{display:flex;gap:1.8rem;list-style:none;}
  .navl a{text-decoration:none;color:var(--gray);font-size:.87rem;font-weight:500;transition:color .2s;}
  .navl a:hover{color:var(--green);}
  .navb{display:flex;gap:.7rem;}
  .bgh{padding:.44rem 1.1rem;border:1.5px solid var(--green);background:transparent;color:var(--green);border-radius:50px;font-family:'DM Sans',sans-serif;font-size:.82rem;font-weight:600;cursor:pointer;transition:all .2s;}
  .bgh:hover{background:var(--green);color:white;}
  .bso{padding:.44rem 1.2rem;background:var(--green);color:white;border:none;border-radius:50px;font-family:'DM Sans',sans-serif;font-size:.82rem;font-weight:600;cursor:pointer;transition:all .2s;}
  .bso:hover{background:var(--dark);}

  .hero{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:7rem 5% 4rem;text-align:center;position:relative;overflow:hidden;animation:up .9s ease 2.5s both;}
  .blob{position:absolute;border-radius:50%;filter:blur(80px);opacity:.25;}
  .b1{width:500px;height:500px;background:var(--gl);top:-100px;right:-100px;}
  .b2{width:300px;height:300px;background:#b7e4c7;bottom:80px;left:-60px;}
  .hc{position:relative;z-index:1;max-width:740px;}
  .hbadge{display:inline-block;background:var(--gp);color:var(--green);padding:.3rem 1rem;border-radius:50px;font-size:.77rem;font-weight:600;margin-bottom:1.3rem;border:1px solid #b7e4c7;}
  h1{font-family:'Playfair Display',serif;font-size:clamp(2.5rem,6vw,4.6rem);font-weight:900;line-height:1.1;margin-bottom:1rem;}
  h1 em{font-style:normal;color:var(--gl);}
  .hp{font-size:1.05rem;color:var(--gray);max-width:500px;margin:0 auto 2rem;line-height:1.7;}
  .hctas{display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;}
  .ctp{padding:.82rem 2rem;background:var(--green);color:white;border:none;border-radius:50px;font-family:'DM Sans',sans-serif;font-size:.93rem;font-weight:600;cursor:pointer;transition:all .25s;box-shadow:0 4px 18px rgba(45,106,79,.3);}
  .ctp:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(45,106,79,.4);}
  .cts{padding:.82rem 2rem;background:white;color:var(--green);border:2px solid var(--gp);border-radius:50px;font-family:'DM Sans',sans-serif;font-size:.93rem;font-weight:600;cursor:pointer;transition:all .25s;}
  .cts:hover{border-color:var(--green);}
  .hstats{display:flex;gap:2.5rem;justify-content:center;margin-top:3.5rem;flex-wrap:wrap;}
  .sn{font-family:'Playfair Display',serif;font-size:1.9rem;font-weight:900;color:var(--green);}
  .slb{font-size:.77rem;color:var(--gray);margin-top:.15rem;}

  section{padding:5rem 5%;}
  .features{background:white;}
  .how{background:var(--cream);}
  .reviews{background:white;}
  .slabel{text-align:center;font-size:.74rem;font-weight:600;color:var(--gl);letter-spacing:2px;text-transform:uppercase;margin-bottom:.65rem;}
  .stitle{font-family:'Playfair Display',serif;font-size:clamp(1.7rem,4vw,2.7rem);font-weight:900;text-align:center;margin-bottom:.75rem;}
  .ssub{text-align:center;color:var(--gray);font-size:.92rem;max-width:460px;margin:0 auto 3rem;}
  .fg{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1.6rem;max-width:1060px;margin:0 auto;}
  .fc{padding:1.7rem;border-radius:16px;border:1px solid #e8f4ec;transition:all .3s;}
  .fc:hover{border-color:var(--gl);box-shadow:0 6px 22px rgba(82,183,136,.12);transform:translateY(-3px);}
  .fi{width:46px;height:46px;border-radius:11px;background:var(--gp);display:flex;align-items:center;justify-content:center;font-size:1.3rem;margin-bottom:.9rem;}
  .fc h3{font-family:'Playfair Display',serif;font-size:1.05rem;font-weight:700;margin-bottom:.45rem;}
  .fc p{color:var(--gray);font-size:.85rem;line-height:1.6;}
  .steps{display:flex;gap:1.4rem;max-width:840px;margin:0 auto;justify-content:center;flex-wrap:wrap;}
  .step{flex:1;min-width:170px;text-align:center;}
  .stepn{width:42px;height:42px;border-radius:50%;background:var(--green);color:white;font-family:'Playfair Display',serif;font-size:1.1rem;font-weight:900;display:flex;align-items:center;justify-content:center;margin:0 auto .85rem;}
  .step h3{font-weight:600;font-size:.93rem;margin-bottom:.32rem;}
  .step p{font-size:.8rem;color:var(--gray);line-height:1.5;}
  .stl{flex:0 0 36px;align-self:center;height:2px;background:var(--gp);margin-bottom:1.4rem;}
  .rg{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1.3rem;max-width:960px;margin:0 auto;}
  .rc{background:var(--cream);border-radius:13px;padding:1.5rem;border:1px solid #e8f4ec;}
  .stars{color:#f4a261;font-size:.87rem;margin-bottom:.65rem;}
  .rt{font-size:.85rem;color:var(--gray);line-height:1.7;margin-bottom:1rem;font-style:italic;}
  .rv{display:flex;align-items:center;gap:.65rem;}
  .rav{width:32px;height:32px;border-radius:50%;background:var(--gp);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.82rem;color:var(--green);}
  .rn{font-size:.82rem;font-weight:600;}
  .rr{font-size:.71rem;color:var(--gray);}
  footer{background:var(--dark);color:#8fb896;padding:2.3rem 5%;text-align:center;}
  .flogo{font-family:'Playfair Display',serif;font-size:1.5rem;font-weight:900;color:var(--gl);margin-bottom:.4rem;}
  .flinks{display:flex;gap:1.6rem;justify-content:center;flex-wrap:wrap;margin:1rem 0;}
  .flinks a{color:#8fb896;text-decoration:none;font-size:.8rem;}
  .fbot{font-size:.77rem;border-top:1px solid #2d4a32;padding-top:1rem;margin-top:.9rem;}

  /* MODALS */
  .mo{position:fixed;inset:0;background:rgba(10,20,12,.65);z-index:1000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px);padding:1rem;overflow-y:auto;}
  .mo.open{display:flex;}
  .md{background:white;border-radius:22px;padding:2.2rem;width:90%;max-width:400px;position:relative;animation:mIn .3s ease;overflow:hidden;}
  @keyframes mIn{from{opacity:0;transform:scale(.92) translateY(14px);}to{opacity:1;transform:none;}}
  .mc{position:absolute;top:.9rem;right:.9rem;background:none;border:none;font-size:1.2rem;cursor:pointer;color:var(--gray);}
  .md h2{font-family:'Playfair Display',serif;font-size:1.65rem;font-weight:900;margin-bottom:.22rem;}
  .md>p{color:var(--gray);font-size:.85rem;margin-bottom:1.4rem;}
  .mfg{margin-bottom:1rem;}
  .mfg label{display:block;font-size:.79rem;font-weight:600;margin-bottom:.36rem;}
  .mfg input{width:100%;padding:.68rem .93rem;border:1.5px solid #e0ece3;border-radius:10px;font-family:'DM Sans',sans-serif;font-size:.87rem;outline:none;transition:border .2s;}
  .mfg input:focus{border-color:var(--gl);}
  .bfull{width:100%;padding:.78rem;background:var(--green);color:white;border:none;border-radius:11px;font-family:'DM Sans',sans-serif;font-size:.93rem;font-weight:600;cursor:pointer;transition:background .2s;margin-top:.35rem;}
  .bfull:hover{background:var(--dark);}
  .bfull:disabled{opacity:.6;cursor:not-allowed;}
  .mswitch{text-align:center;margin-top:.9rem;font-size:.82rem;color:var(--gray);}
  .mswitch a{color:var(--green);font-weight:600;cursor:pointer;}
  .gbtn{width:100%;padding:.68rem;border:1.5px solid #e0ece3;background:white;border-radius:11px;font-family:'DM Sans',sans-serif;font-size:.86rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:.52rem;transition:all .2s;margin-bottom:.9rem;}
  .gbtn:hover{border-color:#bbb;background:#fafafa;}
  .divider{display:flex;align-items:center;gap:.85rem;margin-bottom:.9rem;color:var(--gray);font-size:.77rem;}
  .divider::before,.divider::after{content:'';flex:1;height:1px;background:#e0ece3;}
  .alert{padding:.55rem .9rem;border-radius:8px;font-size:.82rem;margin-bottom:.75rem;display:none;}
  .alert.err{background:#fee2e2;color:#dc2626;display:block;}
  .alert.ok{background:#dcfce7;color:#16a34a;display:block;}
  /* Google One-tap container */
  #g_id_onload{position:fixed;top:80px;right:20px;z-index:2000;}

  /* Google button wrapper â€” ensures it never overflows modal on mobile */
  .g-btn-wrap{width:100%;overflow:hidden;margin-bottom:.9rem;display:flex;justify-content:center;}
  .g-btn-wrap>div{width:100%!important;max-width:100%!important;}
  .g-btn-wrap iframe{width:100%!important;min-width:unset!important;}

  /* Modal full-width on very small screens */
  @media(max-width:440px){
    .md{padding:1.5rem 1.1rem;border-radius:16px;}
    .md h2{font-size:1.35rem;}
  }
  @media(max-width:640px){.navl{display:none;}.hstats{gap:1.4rem;}}

    /* â•â•â• INDEX MOBILE â•â•â• */
    @media (max-width: 768px) {
      .nav { padding: .9rem 1.1rem !important; }
      .navl { display: none !important; }
      .hero { padding: 5rem 1.2rem 3rem !important; }
      .hero h1 { font-size: 2rem !important; }
      .hero p { font-size: 1rem !important; }
      .hbtns { flex-direction: column !important; align-items: center !important; }
      .hbtns a { width: 100% !important; max-width: 320px !important; text-align: center !important; }
      .hstats { gap: 1.5rem !important; flex-wrap: wrap !important; justify-content: center !important; }
      .features-grid { grid-template-columns: 1fr !important; gap: 1rem !important; }
      .how-grid { grid-template-columns: 1fr 1fr !important; }
      .reviews-grid { grid-template-columns: 1fr !important; }
      .footer-links { flex-direction: column !important; gap: .6rem !important; }
      input, select { font-size: 16px !important; }
      .modal-panel { padding: 1.5rem 1.2rem !important; border-radius: 20px 20px 0 0 !important; }
      .modal-overlay { align-items: flex-end !important; }
    }
    @supports (padding: env(safe-area-inset-top)) {
      .nav { padding-top: max(.9rem, env(safe-area-inset-top)) !important; }
    }

  </style>
</head>
<body>

<!-- Google Identity Services -->
<script src="https://accounts.google.com/gsi/client" async defer></script>
<div id="g_id_onload" data-client_id="" data-callback="handleGoogleSignIn" data-auto_select="false"></div>

<div id="splash">
  <div class="sl">ğŸŒ¿ NutriSync</div>
  <div class="st">Sync your meals. Energize your life.</div>
  <div class="sb"><div class="sf"></div></div>
</div>

<nav>
  <div class="nav-logo">Nutri<span>Sync</span></div>
  <ul class="navl">
    <li><a href="#features">Features</a></li>
    <li><a href="#how">How It Works</a></li>
    <li><a href="#reviews">Reviews</a></li>
  </ul>
  <div class="navb" id="navBtns">
    <button class="bgh" onclick="openModal('login')">Login</button>
    <button class="bso" onclick="openModal('signup')">Sign Up Free</button>
  </div>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="blob b1"></div><div class="blob b2"></div>
  <div class="hc">
    <span class="hbadge">ğŸ¤– AI-Powered Nutrition Platform</span>
    <h1>Meals that <em>adapt</em><br>to your body & life</h1>
    <p class="hp">NutriSync uses Gemini AI + your fitness data to generate a fully personalized 7-day meal plan â€” rebuilt every week, just for you.</p>
    <div class="hctas">
      <button class="ctp" onclick="window.location.href='/planner'">ğŸš€ Build My Meal Plan</button>
      <button class="cts" onclick="openModal('signup')">Create Free Account</button>
    </div>
    <div class="hstats">
      <div><div class="sn">10K+</div><div class="slb">Plans Generated</div></div>
      <div><div class="sn">98%</div><div class="slb">Satisfaction</div></div>
      <div><div class="sn">7-Day</div><div class="slb">Adaptive Plans</div></div>
    </div>
  </div>
</section>

<!-- FEATURES -->
<section class="features" id="features">
  <div class="slabel">What We Offer</div>
  <h2 class="stitle">Everything your body needs</h2>
  <p class="ssub">Science-backed nutrition, personalized to every layer of your life.</p>
  <div class="fg">
    <div class="fc"><div class="fi">ğŸ§ </div><h3>AI-Personalized Plans</h3><p>Gemini AI generates a complete 7-day plan based on your BMR, TDEE, goals, and preferences.</p></div>
    <div class="fc"><div class="fi">ğŸƒ</div><h3>Activity Adaptive</h3><p>Calorie targets auto-adjust based on your daily steps and activity â€” no more one-size-fits-all.</p></div>
    <div class="fc"><div class="fi">âš•ï¸</div><h3>Medical-Aware</h3><p>Accounts for diabetes, hypertension, PCOS, thyroid, and more when planning nutrition.</p></div>
    <div class="fc"><div class="fi">ğŸŒ</div><h3>Multi-Cuisine</h3><p>Indian, Mediterranean, Asian, Keto, Vegan â€” enjoy food you actually love.</p></div>
    <div class="fc"><div class="fi">ğŸ’°</div><h3>Budget-Smart</h3><p>Low, Moderate, or Premium budget tiers â€” plans that respect your wallet.</p></div>
    <div class="fc"><div class="fi">ğŸ“Š</div><h3>Live Dashboard</h3><p>Track progress, view past plans, see how activity affects your calories in real time.</p></div>
  </div>
</section>

<!-- HOW -->
<section class="how" id="how">
  <div class="slabel">Process</div>
  <h2 class="stitle">How NutriSync Works</h2>
  <p class="ssub">Four steps to your perfect meal plan.</p>
  <div class="steps">
    <div class="step"><div class="stepn">1</div><h3>Enter Profile</h3><p>Age, height, weight, goals, medical conditions.</p></div>
    <div class="stl"></div>
    <div class="step"><div class="stepn">2</div><h3>Set Preferences</h3><p>Cuisine, dietary style, allergies, budget.</p></div>
    <div class="stl"></div>
    <div class="step"><div class="stepn">3</div><h3>AI Generates</h3><p>Gemini AI creates your personalized 7-day plan.</p></div>
    <div class="stl"></div>
    <div class="step"><div class="stepn">4</div><h3>It Adapts</h3><p>Activity data adjusts your calories daily.</p></div>
  </div>
</section>

<!-- REVIEWS -->
<section class="reviews" id="reviews">
  <div class="slabel">Testimonials</div>
  <h2 class="stitle">People love NutriSync</h2>
  <p class="ssub">Real results from real users.</p>
  <div class="rg">
    <div class="rc"><div class="stars">â˜…â˜…â˜…â˜…â˜…</div><p class="rt">"Finally a planner that respects my PCOS. The AI actually understands my condition."</p><div class="rv"><div class="rav">P</div><div><div class="rn">Priya M.</div><div class="rr">Fitness Enthusiast</div></div></div></div>
    <div class="rc"><div class="stars">â˜…â˜…â˜…â˜…â˜…</div><p class="rt">"On days I walk 12,000 steps, my dinner plan adds more carbs automatically. Incredible!"</p><div class="rv"><div class="rav">R</div><div><div class="rn">Rahul K.</div><div class="rr">Marathon Runner</div></div></div></div>
    <div class="rc"><div class="stars">â˜…â˜…â˜…â˜…â˜…</div><p class="rt">"Full week of healthy meals under â‚¹500/day. AI nutrition that's actually accessible."</p><div class="rv"><div class="rav">S</div><div><div class="rn">Sneha T.</div><div class="rr">College Student</div></div></div></div>
  </div>
</section>

<footer>
  <div class="flogo">ğŸŒ¿ NutriSync</div>
  <div style="font-size:.82rem">Sync your meals. Energize your life.</div>
  <div class="flinks"><a href="#">Privacy</a><a href="#">Terms</a><a href="/api/health">API Status</a></div>
  <div class="fbot">Â© 2025 NutriSync Â· Built for better health.</div>
</footer>

<!-- LOGIN MODAL -->
<div class="mo" id="loginModal">
  <div class="md">
    <button class="mc" onclick="closeModal('login')">âœ•</button>
    <h2>Welcome back ğŸ‘‹</h2>
    <p>Login to your NutriSync account.</p>
    <div class="alert" id="lAlert"></div>
    <div id="gLoginBtn" style="display:none">
      <div class="g-btn-wrap"><div id="g_signin_login"></div></div>
      <div class="divider">or use email</div>
    </div>
    <div id="gLoginFallback" class="gbtn" onclick="triggerGoogleLogin('login')">
      <svg width="16" height="16" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.5 0 6.6 1.2 9 3.2l6.7-6.7C35.7 2.3 30.2 0 24 0 14.7 0 6.7 5.5 2.7 13.5l7.8 6C12.3 13.1 17.7 9.5 24 9.5z"/><path fill="#34A853" d="M46.5 24.5c0-1.5-.1-3-.4-4.5H24v9h12.7c-.6 3-2.3 5.5-4.8 7.2l7.5 5.8c4.4-4 7.1-10 7.1-17.5z"/><path fill="#FBBC05" d="M10.5 28.5c-.5-1.5-.8-3-.8-4.5s.3-3 .8-4.5l-7.8-6C1 16.5 0 20.1 0 24s1 7.5 2.7 10.5l7.8-6z"/><path fill="#4285F4" d="M24 48c6.2 0 11.5-2 15.3-5.5l-7.5-5.8c-2 1.4-4.6 2.3-7.8 2.3-6.3 0-11.7-3.6-13.5-9l-7.8 6C6.7 42.5 14.7 48 24 48z"/></svg>
      Continue with Google
    </div>
    <div class="mfg"><label>Email</label><input type="email" id="li-e" placeholder="you@example.com"/></div>
    <div class="mfg"><label>Password</label><input type="password" id="li-p" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')loginUser()"/></div>
    <button class="bfull" id="loginBtn" onclick="loginUser()">Login</button>
    <div class="mswitch">No account? <a onclick="switchModal('login','signup')">Sign Up</a></div>
  </div>
</div>

<!-- SIGNUP MODAL -->
<div class="mo" id="signupModal">
  <div class="md">
    <button class="mc" onclick="closeModal('signup')">âœ•</button>
    <h2>Join NutriSync ğŸŒ¿</h2>
    <p>Create your free account.</p>
    <div class="alert" id="sAlert"></div>
    <div id="gSignupBtn" style="display:none">
      <div class="g-btn-wrap"><div id="g_signin_signup"></div></div>
      <div class="divider">or use email</div>
    </div>
    <div id="gSignupFallback" class="gbtn" onclick="triggerGoogleLogin('signup')">
      <svg width="16" height="16" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.5 0 6.6 1.2 9 3.2l6.7-6.7C35.7 2.3 30.2 0 24 0 14.7 0 6.7 5.5 2.7 13.5l7.8 6C12.3 13.1 17.7 9.5 24 9.5z"/><path fill="#34A853" d="M46.5 24.5c0-1.5-.1-3-.4-4.5H24v9h12.7c-.6 3-2.3 5.5-4.8 7.2l7.5 5.8c4.4-4 7.1-10 7.1-17.5z"/><path fill="#FBBC05" d="M10.5 28.5c-.5-1.5-.8-3-.8-4.5s.3-3 .8-4.5l-7.8-6C1 16.5 0 20.1 0 24s1 7.5 2.7 10.5l7.8-6z"/><path fill="#4285F4" d="M24 48c6.2 0 11.5-2 15.3-5.5l-7.5-5.8c-2 1.4-4.6 2.3-7.8 2.3-6.3 0-11.7-3.6-13.5-9l-7.8 6C6.7 42.5 14.7 48 24 48z"/></svg>
      Sign Up with Google
    </div>
    <div class="mfg"><label>Full Name</label><input type="text" id="su-n" placeholder="Your Name"/></div>
    <div class="mfg"><label>Email</label><input type="email" id="su-e" placeholder="you@example.com"/></div>
    <div class="mfg"><label>Password</label><input type="password" id="su-p" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')signupUser()"/></div>
    <button class="bfull" id="signupBtn" onclick="signupUser()">Create Account</button>
    <div class="mswitch">Already have an account? <a onclick="switchModal('signup','login')">Login</a></div>
  </div>
</div>

<script>
// â”€â”€â”€ Modal controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(t){document.getElementById(t+'Modal').classList.add('open');}
function closeModal(t){document.getElementById(t+'Modal').classList.remove('open');}
function switchModal(a,b){closeModal(a);openModal(b);}
document.querySelectorAll('.mo').forEach(el=>el.addEventListener('click',e=>{if(e.target===el)el.classList.remove('open');}));
function showAlert(id,msg,type='err'){const el=document.getElementById(id);el.textContent=msg;el.className='alert '+(type||'err');}
function setLoading(id,loading){const b=document.getElementById(id);b.disabled=loading;b.textContent=loading?'Please wait...':b.dataset.label||b.textContent;}

// â”€â”€â”€ Auth functions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loginUser(){
  const email=document.getElementById('li-e').value.trim();
  const password=document.getElementById('li-p').value;
  if(!email||!password){showAlert('lAlert','Please fill in all fields');return;}
  document.getElementById('loginBtn').disabled=true;
  document.getElementById('loginBtn').textContent='Logging in...';
  try{
    const r=await fetch(window.API_BASE + '/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});
    const d=await r.json();
    if(r.ok){
      localStorage.setItem('token',d.token);
      localStorage.setItem('userName',d.name);
      showAlert('lAlert','âœ… Success! Redirecting...','ok');
      setTimeout(()=>window.location.href='/dashboard',700);
    } else {
      showAlert('lAlert',d.detail||'Login failed');
      document.getElementById('loginBtn').disabled=false;
      document.getElementById('loginBtn').textContent='Login';
    }
  }catch(e){
    showAlert('lAlert','Cannot connect to server. Is the backend running?');
    document.getElementById('loginBtn').disabled=false;
    document.getElementById('loginBtn').textContent='Login';
  }
}

async function signupUser(){
  const name=document.getElementById('su-n').value.trim();
  const email=document.getElementById('su-e').value.trim();
  const password=document.getElementById('su-p').value;
  if(!name||!email||!password){showAlert('sAlert','Please fill in all fields');return;}
  if(password.length<6){showAlert('sAlert','Password must be at least 6 characters');return;}
  document.getElementById('signupBtn').disabled=true;
  document.getElementById('signupBtn').textContent='Creating account...';
  try{
    const r=await fetch(window.API_BASE + '/api/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,email,password})});
    const d=await r.json();
    if(r.ok){
      localStorage.setItem('token',d.token);
      localStorage.setItem('userName',d.name);
      showAlert('sAlert','âœ… Account created! Redirecting...','ok');
      setTimeout(()=>window.location.href='/dashboard',700);
    } else {
      showAlert('sAlert',d.detail||'Signup failed');
      document.getElementById('signupBtn').disabled=false;
      document.getElementById('signupBtn').textContent='Create Account';
    }
  }catch(e){
    showAlert('sAlert','Cannot connect to server. Is the backend running?');
    document.getElementById('signupBtn').disabled=false;
    document.getElementById('signupBtn').textContent='Create Account';
  }
}

// â”€â”€â”€ Google Sign-In â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let googleClientId = '';

async function initGoogleSignIn(){
  try{
    const r = await fetch(window.API_BASE + '/api/google-client-id');
    const d = await r.json();
    googleClientId = d.client_id || '';
    if(googleClientId){
      // Update the g_id_onload element
      document.getElementById('g_id_onload').dataset.clientId = googleClientId;
      // Render actual Google buttons
      document.getElementById('gLoginFallback').style.display='none';
      document.getElementById('gSignupFallback').style.display='none';
      document.getElementById('gLoginBtn').style.display='block';
      document.getElementById('gSignupBtn').style.display='block';
      // Initialize Google Identity Services
      if(window.google){
        google.accounts.id.initialize({
          client_id: googleClientId,
          callback: handleGoogleSignIn
        });
        // Responsive width: fit modal on mobile (max 360, min 240)
        const mw = Math.min(Math.max(document.querySelector('.md')?.offsetWidth - 44 || 320, 240), 360);
        google.accounts.id.renderButton(document.getElementById('g_signin_login'),{theme:'outline',size:'large',width:mw,text:'signin_with'});
        google.accounts.id.renderButton(document.getElementById('g_signin_signup'),{theme:'outline',size:'large',width:mw,text:'signup_with'});
      }
    }
  }catch(e){}
}

async function handleGoogleSignIn(response){
  const alertId = document.getElementById('loginModal').classList.contains('open') ? 'lAlert' : 'sAlert';
  try{
    const r = await fetch(window.API_BASE + '/api/google-login',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({credential: response.credential})
    });
    const d = await r.json();
    if(r.ok){
      localStorage.setItem('token',d.token);
      localStorage.setItem('userName',d.name);
      showAlert(alertId,'âœ… Google sign-in successful! Redirecting...','ok');
      setTimeout(()=>window.location.href='/dashboard',700);
    } else {
      showAlert(alertId, d.detail||'Google sign-in failed');
    }
  }catch(e){
    showAlert(alertId,'Google sign-in failed. Please try email login.');
  }
}

// Fallback: trigger Google One-Tap prompt
function triggerGoogleLogin(type){
  if(window.google && googleClientId){
    google.accounts.id.prompt();
  } else {
    showAlert(type==='login'?'lAlert':'sAlert',
      'âš ï¸ Google Sign-In not configured. Add GOOGLE_CLIENT_ID to your .env file. Use email login for now.');
  }
}

// â”€â”€â”€ Nav update if logged in â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkLoggedIn(){
  const token = localStorage.getItem('token');
  const name = localStorage.getItem('userName');
  if(token && name){
    document.getElementById('navBtns').innerHTML=
      `<span style="font-size:.85rem;color:var(--gray)">Hi, ${name.split(' ')[0]} ğŸ‘‹</span>
       <button class="bso" onclick="window.location.href='/dashboard'">Dashboard â†’</button>`;
  }
}

// â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
checkLoggedIn();
window.addEventListener('load', initGoogleSignIn);
</script>
</body>
</html>